$(document).ready(function(){let t="https://c64-diagnostic.fly.dev";var e={precheck:"",system_power_supply:"",system_reset:"",system_clocks:"",system_video:"",system_ram:"",system_rom_io:""},s=JSON.parse(localStorage.getItem("history"))||[],i="ntsc";function n(s){$.ajax({url:t+"/diagnose",type:"POST",dataType:"json",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",success:function(t){localStorage.setItem("diagnostic",JSON.stringify(t)),!0===t.finish?$.get("templates/diagnostic.html",function(s){var i,n=s.replace("{{type}}",t.step.type.replace(/_/g," ")).replace("{{category}}",t.step.category).replace("{{diagnostic}}",t.description).replace("{{color}}",(i=t,i.description===i.step.error.diagnostic?"error-diag":"success-diag")).replace("{{description}}",e[t.step.type]);$(".diagnostic").html(n),o()},"html"):$.get("templates/test.html",function(s){var i=s.replace("{{step}}",t.step.step).replace("{{type}}",t.step.type.replace(/_/g," ")).replace("{{category}}",t.step.category).replace("{{test}}",t.step.test).replace("{{description}}",e[t.step.type]);$(".diagnostic").html(i),o()},"html")}})}function c(){$.get("templates/home.html",function(t){$(".diagnostic").html(t)},"html")}function o(){$('input[name="video"][value="'+i+'"]').prop("checked",!0);var t=[];t="pal"===i?[{oldString:"14.3",newString:"17.7"},{oldString:"8.18",newString:"7.88"},]:[{oldString:"17.7",newString:"14.3"},{oldString:"7.88",newString:"8.18"},];var e=$(".question").text();t.forEach(function(t){e=e.replace(t.oldString,t.newString)}),$(".question").text(e)}c(),o(i),$.ajax({url:t+"/metadata",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){e.precheck=t.precheck,e.system_power_supply=t.system_power_supply,e.system_reset=t.system_reset,e.system_clocks=t.system_clocks,e.system_video=t.system_video,e.system_ram=t.system_ram,e.system_rom_io=t.system_rom_io}}),$(document).on("click","#start",function(){n({diagnostic:"precheck",step:"1",result:""})}),$(document).on("click","#restart",function(){localStorage.clear(),c()}),$(document).on("click","#reset",function(){localStorage.clear(),c()}),$(document).on("click","#back",function(){var t=(removed=s.pop(),localStorage.setItem("history",JSON.stringify(s)),removed);void 0===t?c():(t.result="",n(t))}),$(document).on("click",'input[name="video"]',function(){i=$('input[name="video"]:checked').val(),o()}),$(document).on("click",".categories li",function(){var t=$(this).data("category");if("continue"===t)var e=function t(){if(null!==localStorage.getItem("diagnostic")){var e=JSON.parse(localStorage.getItem("diagnostic"));return{diagnostic:e.step.type,step:e.step.step,result:""}}return{diagnostic:"precheck",step:"1",result:""}}();else var e={diagnostic:t,step:"1",result:""};n(e)}),$(document).on("click","#resources",function(){$.get("templates/resources.html",function(t){$(".diagnostic").html(t)},"html")}),$(document).on("click","#about",function(){$.get("templates/about.html",function(t){$(".diagnostic").html(t)},"html")}),$(document).on("click","#home ",function(){$.get("templates/home.html",function(t){$(".diagnostic").html(t)},"html")}),$(document).on("click","#continue",function(){var t=$("input[name='answer']:checked");if(t.length>0){$(".error").hide();var e,i=t.val(),c=JSON.parse(localStorage.getItem("diagnostic")),o={diagnostic:c.step.type,step:c.step.step,result:i};e=o,s.push(e),localStorage.setItem("history",JSON.stringify(s)),n(o)}else $(".error").show()})});